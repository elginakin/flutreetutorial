"0","# Load required libraries"
"0","library(ggplot2)"
"0","library(ggtree)"
"0","library(grid)"
"0",""
"0","# Define the base plot"
"0","tree_ann_p1 <- tree_ann_p + "
"0","  geom_tippoint(aes(fill = factor(`short-clade`), # assigning fill instead of color allows a border"
"0","                    size = RBD), # reflect RBD mutations called by nextclade"
"0","                alpha = 0.9, # transparency of points"
"0","                shape = 21, # empty circle"
"0","                stroke = 0.5) + # point border thickness"
"0","  scale_size(range = c(0.5, 2)) + "
"0","  xlab(""Time"") +"
"0","  guides("
"0","    fill = guide_legend(title = ""Clade"", ncol = 2), # customize our legend"
"0","    size = guide_legend(title = ""RBD Mutations"")"
"0","  ) +"
"0","  theme_tree2( # justify legend "
"0","    legend.position = c(0.40, 0.45),"
"0","    axis.text.x = element_text(size = 10), "
"0","    legend.text = element_text(size = 10), "
"0","    legend.spacing.x = unit(0.01, ""cm""),"
"0","    legend.key.height = unit(0.3, ""cm""),"
"0","    legend.background = element_rect(fill = ""transparent""),"
"0","    legend.key = element_rect(fill = ""transparent"", colour = ""transparent"") # Make legend key backgrounds transparent"
"0","  ) +"
"0","  scale_x_continuous( # define x axis labels and breaks"
"0","    breaks = seq(2009, 2023, by = 2), "
"0","    labels = seq(2009, 2023, by = 2)"
"0","  ) + # define the date increment shown"
"0","  scale_fill_manual(values = palette) # Set to our palette for points"
"0",""
"0","# Adding alternating grey and white background for each year"
"0","for (year in seq(2008, 2023, by = 1)) {"
"0","  tree_ann_p1 <- tree_ann_p1 +"
"0","    annotation_custom("
"0","      grob = rectGrob(gp = gpar(fill = ifelse(year %% 2 == 0, "
"0","                                                ""grey80"", "
"0","                                                ""white""), "
"0","                                                col = NA, "
"0","                                                alpha = 0.3)),"
"0","      xmin = year, xmax = year + 1, ymin = -Inf, ymax = Inf"
"0","    )"
"0","}"
"0",""
"0","tree_ann_p1"
"0",""
